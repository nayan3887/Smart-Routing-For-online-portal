<HTML>
<HEAD>
<Title>Interactive Financial Chart</Title>
<link type='text/css' rel='Stylesheet' href="maxchartapi.css" />
</HEAD>
<body bgcolor="#FFFFFF" text="#000000" topmargin="0" leftmargin="0" rightmargin="0" marginwidth="0" marginheight="0">
<p class="heading0">ChartDirector Ver 5.0 (Java Edition)</p>
<p class="heading1">Interactive Financial Chart</p>
<hr class="separator">
<div class="content">
<img src="images/financedemo.png"><br><br>
This example demonstrates a full-featured financial chart in which the user can select the time ranges, technical indicators, and various chart options.<br><br>
This sample program is available as a JSP application, and also as a standalone Java application.
</div><p class="heading1a">Interactive Financial Chart in JSP</p><div class="content">
The Interactive Financial Chart is implemented in two parts - "financedemo.jsp" for the containing web page, and "financedemochart.jsp" for the charting page.<br><br>
The containing web page "financedemo.jsp"  is basically just a standard HTML Form. When the "Update Chart" button is pressed, instead of posting to the server, a client side Javascript function is activated. This function combines all Form elements into a query string, appends it to the charting URL "financedemochart.jsp"  and uses it to update the &lt;IMG&gt; tag.<br><br>
The "financedemochart.jsp" draws the finance chart according to the query parameters, which reflects user selections, and outputs the chart to the &lt;IMG&gt; tag.<br><br>
The "financedemochart.jsp" contains two key parts.<br><br>
<ul>
<li>The get15MinData, getDailyData, getWeeklyData and getMonthlyData functions are for retrieving stock data. In this example, they just retrieve data from a random number generator. You may replace the code in these functions with your own code to get data from your data source.<br><br>
<li>The drawChart function is the real charting code. It creates a <a href="FinanceChart.htm">FinanceChart</a> object, sets data to it, and configures it according to query parameters.<br><br>
</ul>
<b>[JSP Version]</b> jspdemo/financedemo.jsp
<table width="98%" border="0" cellpadding="10"><tr><td bgcolor="#cccccc"><pre>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;ChartDirector Financial Chart Demonstration&lt;/title&gt;
&lt;style&gt;
.inputtitle {font-size:11px; margin:10px 5px; font-family:verdana}
.input {font-size:11px; font-family:verdana}
&lt;/style&gt;
&lt;script language="Javascript"&gt;

//Cross browser method to get an object
function getObject(id)
{
    if (document.getElementById)
        //IE 5.x or NS 6.x or above
        return document.getElementById(id);
    else if (document.all)
        //IE 4.x
        return document.all[id];
    else
        //Netscape 4.x
        return document[id];
}

//Update the chart according to user selection
function updateChart()
{
    //
    //we encode the values of all form elements as query parameters
    //
    var elements = getObject("Form1").elements;
    var url = "financedemochart.jsp?";
    for (var i = 0; i &lt; elements.length; ++i)
    {
        var e = elements[i];
        if (e.type == "checkbox")
            url = url + e.id + "=" + (e.checked ? "1" : "0") + "&";
        else
            url = url + e.id + "=" + escape(e.value) + "&";
    }

    //Now we update the URL of the image to update the chart
    getObject("ChartImage").src = url;
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body style="margin:0px" onLoad="updateChart();"&gt;
&lt;table cellspacing="0" cellpadding="0" border="0"&gt;
    &lt;tr&gt;
        &lt;td align="right" colspan="2" style="background:#000088"&gt;
            &lt;div style="padding-right:3px; padding-bottom:2px; font-family:arial; font-size:10pt; font-weight:bold; font-style:italic"&gt;
                &lt;a style="color:#ffff00; text-decoration:none" href="http://www.advsofteng.com"&gt;
                    Advanced Software Engineering
                &lt;/a&gt;
            &lt;/div&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr valign="top"&gt;
        &lt;td style="width:150px; background:#bbddff"&gt;
            &lt;form id="Form1" action="javascript:updateChart()"&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Ticker Symbol&lt;/b&gt;&lt;br /&gt;
                &lt;input id="TickerSymbol" name="TickerSymbol" class="input" style="width:140px;" value="ASE.SYMBOL"&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Compare With&lt;/b&gt;&lt;br /&gt;
                &lt;input id="CompareWith" name="CompareWith" class="input" style="width:140px;" value=""&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Time Period&lt;/b&gt;&lt;br /&gt;
                &lt;select id="TimeRange" name="TimeRange" class="input" style="width:140px;"&gt;
                    &lt;option value="1"&gt;1 day&lt;/option&gt;
                    &lt;option value="2"&gt;2 days&lt;/option&gt;
                    &lt;option value="5"&gt;5 days&lt;/option&gt;
                    &lt;option value="10"&gt;10 days&lt;/option&gt;
                    &lt;option value="30"&gt;1 month&lt;/option&gt;
                    &lt;option value="60"&gt;2 months&lt;/option&gt;
                    &lt;option value="90"&gt;3 months&lt;/option&gt;
                    &lt;option value="180" selected&gt;6 months&lt;/option&gt;
                    &lt;option value="360"&gt;1 year&lt;/option&gt;
                    &lt;option value="720"&gt;2 years&lt;/option&gt;
                    &lt;option value="1080"&gt;3 years&lt;/option&gt;
                    &lt;option value="1440"&gt;4 years&lt;/option&gt;
                    &lt;option value="1800"&gt;5 years&lt;/option&gt;
                    &lt;option value="3600"&gt;10 years&lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Chart Size&lt;/b&gt;&lt;br /&gt;
                &lt;select id="ChartSize" name="ChartSize" class="input" style="width:140px;"&gt;
                    &lt;option value="S"&gt;Small&lt;/option&gt;
                    &lt;option value="M"&gt;Medium&lt;/option&gt;
                    &lt;option value="L" selected&gt;Large&lt;/option&gt;
                    &lt;option value="H"&gt;Huge&lt;/option&gt;
                &lt;/select&gt;&lt;br /&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;input type="checkbox" id="Volume" name="Volume" checked&gt;&lt;label for="Volume"&gt;Show Volume Bars&lt;/label&gt;&lt;br /&gt;
                &lt;input type="checkbox" id="ParabolicSAR" name="ParabolicSAR"&gt;&lt;label for="ParabolicSAR"&gt;Parabolic SAR&lt;/label&gt;&lt;br /&gt;
                &lt;input type="checkbox" id="LogScale" name="LogScale"&gt;&lt;label for="LogScale"&gt;Log Scale&lt;/label&gt;&lt;br /&gt;
                &lt;input type="checkbox" id="PercentageScale" name="PercentageScale"&gt;&lt;label for="PercentageScale"&gt;Percentage Scale&lt;/label&gt;&lt;br /&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Chart Type&lt;/b&gt;&lt;br /&gt;
                &lt;select id="ChartType" name="ChartType" class="input" style="width:140px;"&gt;
                    &lt;option value="None"&gt;None&lt;/option&gt;
                    &lt;option value="CandleStick" selected&gt;CandleStick&lt;/option&gt;
                    &lt;option value="Close"&gt;Closing Price&lt;/option&gt;
                    &lt;option value="Median"&gt;Median Price&lt;/option&gt;
                    &lt;option value="OHLC"&gt;OHLC&lt;/option&gt;
                    &lt;option value="TP"&gt;Typical Price&lt;/option&gt;
                    &lt;option value="WC"&gt;Weighted Close&lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Price Band&lt;/b&gt;&lt;br /&gt;
                &lt;select id="Band" name="Band" class="input" style="width:140px;"&gt;
                    &lt;option value="None"&gt;None&lt;/option&gt;
                    &lt;option value="BB" selected&gt;Bollinger Band&lt;/option&gt;
                    &lt;option value="DC"&gt;Donchain Channel&lt;/option&gt;
                    &lt;option value="Envelop"&gt;Envelop (SMA 20 +/- 10%)&lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Moving Averages&lt;/b&gt;&lt;br /&gt;
                &lt;nobr&gt;&lt;select id="avgType1" name="avgType1" class="input" style="width:105px;"&gt;
                    &lt;option value="None"&gt;None&lt;/option&gt;
                    &lt;option value="SMA" selected&gt;Simple&lt;/option&gt;
                    &lt;option value="EMA"&gt;Exponential&lt;/option&gt;
                    &lt;option value="TMA"&gt;Triangular&lt;/option&gt;
                    &lt;option value="WMA"&gt;Weighted&lt;/option&gt;
                &lt;/select&gt;
                &lt;input id="movAvg1" name="movAvg1" class="input" style="width:30px;" value="10"&gt;&lt;/nobr&gt;&lt;br /&gt;
                &lt;nobr&gt;&lt;select id="avgType2" name="avgType2" class="input" style="width:105px;"&gt;
                    &lt;option value="None"&gt;None&lt;/option&gt;
                    &lt;option value="SMA" selected&gt;Simple&lt;/option&gt;
                    &lt;option value="EMA"&gt;Exponential&lt;/option&gt;
                    &lt;option value="TMA"&gt;Triangular&lt;/option&gt;
                    &lt;option value="WMA"&gt;Weighted&lt;/option&gt;
                &lt;/select&gt;
                &lt;input id="movAvg2" name="movAvg2" class="input" style="width:30px;" value="25"&gt;&lt;/nobr&gt;&lt;br /&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle"&gt;
                &lt;b&gt;Technical Indicators&lt;/b&gt;&lt;br /&gt;
                &lt;select id="Indicator1" name="Indicator1" class="input" style="width:140px;"&gt;
                    &lt;option value="None"&gt;None&lt;/option&gt;
                    &lt;option value="AccDist"&gt;Accumulation/Distribution&lt;/option&gt;
                    &lt;option value="AroonOsc"&gt;Aroon Oscillator&lt;/option&gt;
                    &lt;option value="Aroon"&gt;Aroon Up/Down&lt;/option&gt;
                    &lt;option value="ADX"&gt;Avg Directional Index&lt;/option&gt;
                    &lt;option value="ATR"&gt;Avg True Range&lt;/option&gt;
                    &lt;option value="BBW"&gt;Bollinger Band Width&lt;/option&gt;
                    &lt;option value="CMF"&gt;Chaikin Money Flow&lt;/option&gt;
                    &lt;option value="COscillator"&gt;Chaikin Oscillator&lt;/option&gt;
                    &lt;option value="CVolatility"&gt;Chaikin Volatility&lt;/option&gt;
                    &lt;option value="CLV"&gt;Close Location Value&lt;/option&gt;
                    &lt;option value="CCI"&gt;Commodity Channel Index&lt;/option&gt;
                    &lt;option value="DPO"&gt;Detrended Price Osc&lt;/option&gt;
                    &lt;option value="DCW"&gt;Donchian Channel Width&lt;/option&gt;
                    &lt;option value="EMV"&gt;Ease of Movement&lt;/option&gt;
                    &lt;option value="FStoch"&gt;Fast Stochastic&lt;/option&gt;
                    &lt;option value="MACD"&gt;MACD&lt;/option&gt;
                    &lt;option value="MDX"&gt;Mass Index&lt;/option&gt;
                    &lt;option value="Momentum"&gt;Momentum&lt;/option&gt;
                    &lt;option value="MFI"&gt;Money Flow Index&lt;/option&gt;
                    &lt;option value="NVI"&gt;Neg Volume Index&lt;/option&gt;
                    &lt;option value="OBV"&gt;On Balance Volume&lt;/option&gt;
                    &lt;option value="Performance"&gt;Performance&lt;/option&gt;
                    &lt;option value="PPO"&gt;% Price Oscillator&lt;/option&gt;
                    &lt;option value="PVO"&gt;% Volume Oscillator&lt;/option&gt;
                    &lt;option value="PVI"&gt;Pos Volume Index&lt;/option&gt;
                    &lt;option value="PVT"&gt;Price Volume Trend&lt;/option&gt;
                    &lt;option value="ROC"&gt;Rate of Change&lt;/option&gt;
                    &lt;option value="RSI" selected&gt;RSI&lt;/option&gt;
                    &lt;option value="SStoch"&gt;Slow Stochastic&lt;/option&gt;
                    &lt;option value="StochRSI"&gt;StochRSI&lt;/option&gt;
                    &lt;option value="TRIX"&gt;TRIX&lt;/option&gt;
                    &lt;option value="UO"&gt;Ultimate Oscillator&lt;/option&gt;
                    &lt;option value="Vol"&gt;Volume&lt;/option&gt;
                    &lt;option value="WilliamR"&gt;William's %R&lt;/option&gt;
                &lt;/select&gt;&lt;br /&gt;
                &lt;select id="Indicator2" name="Indicator2" class="input" style="width:140px;"&gt;
                    &lt;option value="None"&gt;None&lt;/option&gt;
                    &lt;option value="AccDist"&gt;Accumulation/Distribution&lt;/option&gt;
                    &lt;option value="AroonOsc"&gt;Aroon Oscillator&lt;/option&gt;
                    &lt;option value="Aroon"&gt;Aroon Up/Down&lt;/option&gt;
                    &lt;option value="ADX"&gt;Avg Directional Index&lt;/option&gt;
                    &lt;option value="ATR"&gt;Avg True Range&lt;/option&gt;
                    &lt;option value="BBW"&gt;Bollinger Band Width&lt;/option&gt;
                    &lt;option value="CMF"&gt;Chaikin Money Flow&lt;/option&gt;
                    &lt;option value="COscillator"&gt;Chaikin Oscillator&lt;/option&gt;
                    &lt;option value="CVolatility"&gt;Chaikin Volatility&lt;/option&gt;
                    &lt;option value="CLV"&gt;Close Location Value&lt;/option&gt;
                    &lt;option value="CCI"&gt;Commodity Channel Index&lt;/option&gt;
                    &lt;option value="DPO"&gt;Detrended Price Osc&lt;/option&gt;
                    &lt;option value="DCW"&gt;Donchian Channel Width&lt;/option&gt;
                    &lt;option value="EMV"&gt;Ease of Movement&lt;/option&gt;
                    &lt;option value="FStoch"&gt;Fast Stochastic&lt;/option&gt;
                    &lt;option value="MACD" selected&gt;MACD&lt;/option&gt;
                    &lt;option value="MDX"&gt;Mass Index&lt;/option&gt;
                    &lt;option value="Momentum"&gt;Momentum&lt;/option&gt;
                    &lt;option value="MFI"&gt;Money Flow Index&lt;/option&gt;
                    &lt;option value="NVI"&gt;Neg Volume Index&lt;/option&gt;
                    &lt;option value="OBV"&gt;On Balance Volume&lt;/option&gt;
                    &lt;option value="Performance"&gt;Performance&lt;/option&gt;
                    &lt;option value="PPO"&gt;% Price Oscillator&lt;/option&gt;
                    &lt;option value="PVO"&gt;% Volume Oscillator&lt;/option&gt;
                    &lt;option value="PVI"&gt;Pos Volume Index&lt;/option&gt;
                    &lt;option value="PVT"&gt;Price Volume Trend&lt;/option&gt;
                    &lt;option value="ROC"&gt;Rate of Change&lt;/option&gt;
                    &lt;option value="RSI"&gt;RSI&lt;/option&gt;
                    &lt;option value="SStoch"&gt;Slow Stochastic&lt;/option&gt;
                    &lt;option value="StochRSI"&gt;StochRSI&lt;/option&gt;
                    &lt;option value="TRIX"&gt;TRIX&lt;/option&gt;
                    &lt;option value="UO"&gt;Ultimate Oscillator&lt;/option&gt;
                    &lt;option value="Vol"&gt;Volume&lt;/option&gt;
                    &lt;option value="WilliamR"&gt;William's %R&lt;/option&gt;
                &lt;/select&gt;&lt;br /&gt;
                &lt;select id="Indicator3" name="Indicator3" class="input" style="width:140px;"&gt;
                    &lt;option value="None" selected&gt;None&lt;/option&gt;
                    &lt;option value="AccDist"&gt;Accumulation/Distribution&lt;/option&gt;
                    &lt;option value="AroonOsc"&gt;Aroon Oscillator&lt;/option&gt;
                    &lt;option value="Aroon"&gt;Aroon Up/Down&lt;/option&gt;
                    &lt;option value="ADX"&gt;Avg Directional Index&lt;/option&gt;
                    &lt;option value="ATR"&gt;Avg True Range&lt;/option&gt;
                    &lt;option value="BBW"&gt;Bollinger Band Width&lt;/option&gt;
                    &lt;option value="CMF"&gt;Chaikin Money Flow&lt;/option&gt;
                    &lt;option value="COscillator"&gt;Chaikin Oscillator&lt;/option&gt;
                    &lt;option value="CVolatility"&gt;Chaikin Volatility&lt;/option&gt;
                    &lt;option value="CLV"&gt;Close Location Value&lt;/option&gt;
                    &lt;option value="CCI"&gt;Commodity Channel Index&lt;/option&gt;
                    &lt;option value="DPO"&gt;Detrended Price Osc&lt;/option&gt;
                    &lt;option value="DCW"&gt;Donchian Channel Width&lt;/option&gt;
                    &lt;option value="EMV"&gt;Ease of Movement&lt;/option&gt;
                    &lt;option value="FStoch"&gt;Fast Stochastic&lt;/option&gt;
                    &lt;option value="MACD"&gt;MACD&lt;/option&gt;
                    &lt;option value="MDX"&gt;Mass Index&lt;/option&gt;
                    &lt;option value="Momentum"&gt;Momentum&lt;/option&gt;
                    &lt;option value="MFI"&gt;Money Flow Index&lt;/option&gt;
                    &lt;option value="NVI"&gt;Neg Volume Index&lt;/option&gt;
                    &lt;option value="OBV"&gt;On Balance Volume&lt;/option&gt;
                    &lt;option value="Performance"&gt;Performance&lt;/option&gt;
                    &lt;option value="PPO"&gt;% Price Oscillator&lt;/option&gt;
                    &lt;option value="PVO"&gt;% Volume Oscillator&lt;/option&gt;
                    &lt;option value="PVI"&gt;Pos Volume Index&lt;/option&gt;
                    &lt;option value="PVT"&gt;Price Volume Trend&lt;/option&gt;
                    &lt;option value="ROC"&gt;Rate of Change&lt;/option&gt;
                    &lt;option value="RSI"&gt;RSI&lt;/option&gt;
                    &lt;option value="SStoch"&gt;Slow Stochastic&lt;/option&gt;
                    &lt;option value="StochRSI"&gt;StochRSI&lt;/option&gt;
                    &lt;option value="TRIX"&gt;TRIX&lt;/option&gt;
                    &lt;option value="UO"&gt;Ultimate Oscillator&lt;/option&gt;
                    &lt;option value="Vol"&gt;Volume&lt;/option&gt;
                    &lt;option value="WilliamR"&gt;William's %R&lt;/option&gt;
                &lt;/select&gt;&lt;br /&gt;
                &lt;select id="Indicator4" name="Indicator4" class="input" style="width:140px;"&gt;
                    &lt;option value="None" selected&gt;None&lt;/option&gt;
                    &lt;option value="AccDist"&gt;Accumulation/Distribution&lt;/option&gt;
                    &lt;option value="AroonOsc"&gt;Aroon Oscillator&lt;/option&gt;
                    &lt;option value="Aroon"&gt;Aroon Up/Down&lt;/option&gt;
                    &lt;option value="ADX"&gt;Avg Directional Index&lt;/option&gt;
                    &lt;option value="ATR"&gt;Avg True Range&lt;/option&gt;
                    &lt;option value="BBW"&gt;Bollinger Band Width&lt;/option&gt;
                    &lt;option value="CMF"&gt;Chaikin Money Flow&lt;/option&gt;
                    &lt;option value="COscillator"&gt;Chaikin Oscillator&lt;/option&gt;
                    &lt;option value="CVolatility"&gt;Chaikin Volatility&lt;/option&gt;
                    &lt;option value="CLV"&gt;Close Location Value&lt;/option&gt;
                    &lt;option value="CCI"&gt;Commodity Channel Index&lt;/option&gt;
                    &lt;option value="DPO"&gt;Detrended Price Osc&lt;/option&gt;
                    &lt;option value="DCW"&gt;Donchian Channel Width&lt;/option&gt;
                    &lt;option value="EMV"&gt;Ease of Movement&lt;/option&gt;
                    &lt;option value="FStoch"&gt;Fast Stochastic&lt;/option&gt;
                    &lt;option value="MACD"&gt;MACD&lt;/option&gt;
                    &lt;option value="MDX"&gt;Mass Index&lt;/option&gt;
                    &lt;option value="Momentum"&gt;Momentum&lt;/option&gt;
                    &lt;option value="MFI"&gt;Money Flow Index&lt;/option&gt;
                    &lt;option value="NVI"&gt;Neg Volume Index&lt;/option&gt;
                    &lt;option value="OBV"&gt;On Balance Volume&lt;/option&gt;
                    &lt;option value="Performance"&gt;Performance&lt;/option&gt;
                    &lt;option value="PPO"&gt;% Price Oscillator&lt;/option&gt;
                    &lt;option value="PVO"&gt;% Volume Oscillator&lt;/option&gt;
                    &lt;option value="PVI"&gt;Pos Volume Index&lt;/option&gt;
                    &lt;option value="PVT"&gt;Price Volume Trend&lt;/option&gt;
                    &lt;option value="ROC"&gt;Rate of Change&lt;/option&gt;
                    &lt;option value="RSI"&gt;RSI&lt;/option&gt;
                    &lt;option value="SStoch"&gt;Slow Stochastic&lt;/option&gt;
                    &lt;option value="StochRSI"&gt;StochRSI&lt;/option&gt;
                    &lt;option value="TRIX"&gt;TRIX&lt;/option&gt;
                    &lt;option value="UO"&gt;Ultimate Oscillator&lt;/option&gt;
                    &lt;option value="Vol"&gt;Volume&lt;/option&gt;
                    &lt;option value="WilliamR"&gt;William's %R&lt;/option&gt;
                &lt;/select&gt;
            &lt;/div&gt;
            &lt;div class="inputtitle" style="text-align:center"&gt;
                &lt;input id="Button1" name="Button1" type="submit" class="input" value="Update Chart"&gt;
            &lt;/div&gt;
            &lt;/form&gt;
        &lt;/td&gt;
        &lt;td&gt;
            &lt;div style="font-weight:bold;  font-family:arial; font-size:20pt; margin:5px 0px 0px 5px"&gt;
                ChartDirector Financial Chart Demonstration
            &lt;/div&gt;
            &lt;hr style="border:solid 1px #000080" /&gt;
            &lt;br /&gt;
            &lt;img id="ChartImage" align="top" border="0"&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></tr></td></table><br>
<b>[JSP Version]</b> jspdemo/financedemochart.jsp
<table width="98%" border="0" cellpadding="10"><tr><td bgcolor="#cccccc"><pre>&lt;%@page import="ChartDirector.*, java.util.*"%&gt;
&lt;%!
//
// Create a finance chart based on user selections, which are encoded as query
// parameters. This code is designed to work with the financedemo HTML form.
//

// The timeStamps, volume, high, low, open and close data
private Date[] timeStamps = null;
double[] volData = null;
double[] highData = null;
double[] lowData = null;
double[] openData = null;
double[] closeData = null;

// An extra data series to compare with the close data
double[] compareData = null;

// The resolution of the data in seconds. 1 day = 86400 seconds.
int resolution = 86400;

/// &lt;summary&gt;
/// Get the timeStamps, highData, lowData, openData, closeData and volData.
/// &lt;/summary&gt;
/// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
/// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
/// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
/// &lt;param name="durationInDays"&gt;The number of trading days to get.&lt;/param&gt;
/// &lt;param name="extraPoints"&gt;The extra leading data points needed in order to
/// compute moving averages.&lt;/param&gt;
/// &lt;returns&gt;True if successfully obtain the data, otherwise false.&lt;/returns&gt;
protected boolean getData(String ticker, GregorianCalendar startDate,
    GregorianCalendar endDate, int durationInDays, int extraPoints)
{
    // This method should return false if the ticker symbol is invalid. In this
    // sample code, as we are using a random number generator for the data, all
    // ticker symbol is allowed, but we still assumed an empty symbol is invalid.
    if (ticker.equals("")) {
        return false;
    }

    // In this demo, we can get 15 min, daily, weekly or monthly data depending on
    // the time range.
    resolution = 86400;
    if (durationInDays &lt;= 10) {
        // 10 days or less, we assume 15 minute data points are available
        resolution = 900;

        // We need to adjust the startDate backwards for the extraPoints. We assume
        // 6.5 hours trading time per day, and 5 trading days per week.
        double dataPointsPerDay = 6.5 * 3600 / resolution;
        GregorianCalendar adjustedStartDate = new GregorianCalendar(startDate.get(Calendar.YEAR),
            startDate.get(Calendar.MONTH), startDate.get(Calendar.DAY_OF_MONTH));
        adjustedStartDate.add(Calendar.DAY_OF_MONTH,
            -(int)Math.ceil(extraPoints / dataPointsPerDay * 7 / 5) - 2);

        // Get the required 15 min data
        get15MinData(ticker, adjustedStartDate.getTime(), endDate.getTime());

    } else if (durationInDays &gt;= 4.5 * 360) {
        // 4 years or more - use monthly data points.
        resolution = 30 * 86400;

        // Adjust startDate backwards to cater for extraPoints
        GregorianCalendar adjustedStartDate = (GregorianCalendar)startDate.clone();
        adjustedStartDate.add(Calendar.MONTH, -extraPoints);

        // Get the required monthly data
        getMonthlyData(ticker, adjustedStartDate.getTime(), endDate.getTime());

    } else if (durationInDays &gt;= 1.5 * 360) {
        // 1 year or more - use weekly points.
        resolution = 7 * 86400;

        // Adjust startDate backwards to cater for extraPoints
        GregorianCalendar adjustedStartDate = (GregorianCalendar)startDate.clone();
        adjustedStartDate.add(Calendar.DAY_OF_MONTH, -extraPoints * 7 - 6);

        // Get the required weekly data
        getWeeklyData(ticker, adjustedStartDate.getTime(), endDate.getTime());

    } else {
        // Default - use daily points
        resolution = 86400;

        // Adjust startDate backwards to cater for extraPoints. We multiply the days
        // by 7/5 as we assume 1 week has 5 trading days.
        GregorianCalendar adjustedStartDate = new GregorianCalendar(startDate.get(Calendar.YEAR),
            startDate.get(Calendar.MONTH), startDate.get(Calendar.DAY_OF_MONTH));
        adjustedStartDate.add(Calendar.DAY_OF_MONTH, - (extraPoints * 7 + 4) / 5 - 2);

        // Get the required daily data
        getDailyData(ticker, adjustedStartDate.getTime(), endDate.getTime());
    }

    return true;
}

/// &lt;summary&gt;
/// Get 15 minutes data series for timeStamps, highData, lowData, openData, closeData
/// and volData.
/// &lt;/summary&gt;
/// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
/// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
/// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
protected void get15MinData(String ticker, Date startDate, Date endDate)
{
    //
    // In this demo, we use a random number generator to generate the data. In
    // practice, you may get the data from a database or by other means. If you do
    // not have 15 minute data, you may modify the "drawChart" method below to not
    // using 15 minute data.
    //
    generateRandomData(ticker, startDate, endDate, 900);
}

/// &lt;summary&gt;
/// Get daily data series for timeStamps, highData, lowData, openData, closeData
/// and volData.
/// &lt;/summary&gt;
/// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
/// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
/// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
protected void getDailyData(String ticker, Date startDate, Date endDate)
{
    //
    // In this demo, we use a random number generator to generate the data. In
    // practice, you may get the data from a database or by other means.
    //
    generateRandomData(ticker, startDate, endDate, 86400);
}

/// &lt;summary&gt;
/// Get weekly data series for timeStamps, highData, lowData, openData, closeData
/// and volData.
/// &lt;/summary&gt;
/// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
/// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
/// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
protected void getWeeklyData(String ticker, Date startDate, Date endDate)
{
    //
    // If you do not have weekly data, you may call "getDailyData(startDate,
    // endDate)" to get daily data, then call "convertDailyToWeeklyData()" to convert
    // to weekly data.
    //
    generateRandomData(ticker, startDate, endDate, 86400 * 7);
}

/// &lt;summary&gt;
/// Get monthly data series for timeStamps, highData, lowData, openData, closeData
/// and volData.
/// &lt;/summary&gt;
/// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
/// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
/// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
protected void getMonthlyData(String ticker, Date startDate, Date endDate)
{
    //
    // If you do not have weekly data, you may call "getDailyData(startDate,
    // endDate)" to get daily data, then call "convertDailyToMonthlyData()" to
    // convert to monthly data.
    //
    generateRandomData(ticker, startDate, endDate, 86400 * 30);
}

/// &lt;summary&gt;
/// A random number generator designed to generate realistic financial data.
/// &lt;/summary&gt;
/// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
/// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
/// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
/// &lt;param name="resolution"&gt;The period of the data series.&lt;/param&gt;
protected void generateRandomData(String ticker, Date startDate, Date endDate,
    int resolution)
{
    FinanceSimulator db = new FinanceSimulator(ticker, startDate, endDate, resolution
        );
    timeStamps = db.getTimeStamps();
    highData = db.getHighData();
    lowData = db.getLowData();
    openData = db.getOpenData();
    closeData = db.getCloseData();
    volData = db.getVolData();
}

/// &lt;summary&gt;
/// A utility to convert daily to weekly data.
/// &lt;/summary&gt;
protected void convertDailyToWeeklyData()
{
    aggregateData(new ArrayMath(timeStamps).selectStartOfWeek());
}

/// &lt;summary&gt;
/// A utility to convert daily to monthly data.
/// &lt;/summary&gt;
protected void convertDailyToMonthlyData()
{
    aggregateData(new ArrayMath(timeStamps).selectStartOfMonth());
}

/// &lt;summary&gt;
/// An internal method used to aggregate daily data.
/// &lt;/summary&gt;
protected void aggregateData(ArrayMath aggregator)
{
    timeStamps = Chart.NTime(aggregator.aggregate(Chart.CTime(timeStamps),
        Chart.AggregateFirst));
    highData = aggregator.aggregate(highData, Chart.AggregateMax);
    lowData = aggregator.aggregate(lowData, Chart.AggregateMin);
    openData = aggregator.aggregate(openData, Chart.AggregateFirst);
    closeData = aggregator.aggregate(closeData, Chart.AggregateLast);
    volData = aggregator.aggregate(volData, Chart.AggregateSum);
}

/// &lt;summary&gt;
/// Create a financial chart according to user selections. The user selections are
/// encoded in the query parameters.
/// &lt;/summary&gt;
public BaseChart drawChart(HttpServletRequest request)
{
    // In this demo, we just assume we plot up to the latest time. So end date is
    // now.
    GregorianCalendar endDate = new GregorianCalendar();

    // If the trading day has not yet started (before 9:30am), or if the end date is
    // on on Sat or Sun, we set the end date to 4:00pm of the last trading day
    while ((endDate.get(Calendar.HOUR_OF_DAY) * 60 + endDate.get(Calendar.MINUTE) &lt;
        9 * 60 + 30) || (endDate.get(Calendar.DAY_OF_WEEK) == Calendar.SUNDAY) ||
        (endDate.get(Calendar.DAY_OF_WEEK) == Calendar.SATURDAY))
    {
        endDate.add(Calendar.DAY_OF_MONTH, -1);
        endDate.set(Calendar.HOUR_OF_DAY, 16);
        endDate.set(Calendar.MINUTE, 0);
        endDate.set(Calendar.SECOND, 0);
    }

    // The duration selected by the user
    int durationInDays = Integer.parseInt(request.getParameter("TimeRange"));

    // Compute the start date by subtracting the duration from the end date.
    GregorianCalendar startDate;
    if (durationInDays &gt;= 30) {
        // More or equal to 30 days - so we use months as the unit
        startDate = new GregorianCalendar(endDate.get(Calendar.YEAR),
            endDate.get(Calendar.MONTH), 1);
        startDate.add(Calendar.MONTH, -durationInDays / 30);
    } else {
        // Less than 30 days - use day as the unit. The starting point of the axis is
        // always at the start of the day (9:30am). Note that we use trading days, so
        // we skip Sat and Sun in counting the days.
        startDate = new GregorianCalendar(endDate.get(Calendar.YEAR),
            endDate.get(Calendar.MONTH), endDate.get(Calendar.DAY_OF_MONTH), 9, 30, 0);
        for (int i = 1; i &lt; durationInDays; ++i)
        {
            startDate.add(Calendar.DAY_OF_MONTH,
                (startDate.get(Calendar.DAY_OF_WEEK) == Calendar.MONDAY) ? -3 : -1);
        }
    }

    // The moving average periods selected by the user.
    int avgPeriod1 = 0;
    try { avgPeriod1 = Integer.parseInt(request.getParameter("movAvg1")); }
    catch (Exception e) { avgPeriod1 = 0; }
    int avgPeriod2 = 0;
    try { avgPeriod2 = Integer.parseInt(request.getParameter("movAvg2")); }
    catch (Exception e) { avgPeriod2 = 0; }

    if (avgPeriod1 &lt; 0) {
        avgPeriod1 = 0;
    } else if (avgPeriod1 &gt; 300) {
        avgPeriod1 = 300;
    }

    if (avgPeriod2 &lt; 0) {
        avgPeriod2 = 0;
    } else if (avgPeriod2 &gt; 300) {
        avgPeriod2 = 300;
    }

    // We need extra leading data points in order to compute moving averages.
    int extraPoints = 20;
    if (avgPeriod1 &gt; extraPoints) {
        extraPoints = avgPeriod1;
    }
    if (avgPeriod2 &gt; extraPoints) {
        extraPoints = avgPeriod2;
    }

    // Get the data series to compare with, if any.
    String compareKey = request.getParameter("CompareWith").trim();
    compareData = null;
    if (getData(compareKey, startDate, endDate, durationInDays, extraPoints)) {
          compareData = closeData;
    }

    // The data series we want to get.
    String tickerKey = request.getParameter("TickerSymbol").trim();
    if (!getData(tickerKey, startDate, endDate, durationInDays, extraPoints)) {
        return errMsg("Please enter a valid ticker symbol");
    }

    // We now confirm the actual number of extra points (data points that are before
    // the start date) as inferred using actual data from the database.
    extraPoints = timeStamps.length;
    Date cutOff = startDate.getTime();
    for (int i = 0; i &lt; timeStamps.length; ++i)
    {
        if (!timeStamps[i].before(cutOff))
        {
            extraPoints = i;
            break;
        }
    }

    // Check if there is any valid data
    if (extraPoints &gt;= timeStamps.length) {
        // No data - just display the no data message.
        return errMsg("No data available for the specified time period");
    }

    // In some finance chart presentation style, even if the data for the latest day
    // is not fully available, the axis for the entire day will still be drawn, where
    // no data will appear near the end of the axis.
    if (resolution &lt; 86400) {
        // Add extra points to the axis until it reaches the end of the day. The end
        // of day is assumed to be 16:00 (it depends on the stock exchange).
        GregorianCalendar lastTime = new GregorianCalendar();
        lastTime.setTime(timeStamps[timeStamps.length - 1]);
        int extraTrailingPoints = (int)((16 * 3600 - lastTime.get(Calendar.HOUR_OF_DAY) * 3600
            - lastTime.get(Calendar.MINUTE) * 60 - lastTime.get(Calendar.SECOND)) / resolution);
        if (extraTrailingPoints &gt; 0)
        {
            Date[] extendedTimeStamps = new Date[timeStamps.length + extraTrailingPoints];
            System.arraycopy(timeStamps, 0, extendedTimeStamps, 0, timeStamps.length);
            for (int i = 0; i &lt; extraTrailingPoints; ++i)
            {
                lastTime.add(Calendar.SECOND, resolution);
                extendedTimeStamps[i + timeStamps.length] = (Date)lastTime.getTime().clone();
            }
            timeStamps = extendedTimeStamps;
        }
    }

    //
    // At this stage, all data are available. We can draw the chart as according to
    // user input.
    //

    //
    // Determine the chart size. In this demo, user can select 4 different chart
    // sizes. Default is the large chart size.
    //
    int width = 780;
    int mainHeight = 255;
    int indicatorHeight = 80;

    String size = request.getParameter("ChartSize");
    if (size.equals("S")) {
        // Small chart size
        width = 450;
        mainHeight = 160;
        indicatorHeight = 60;
    } else if (size.equals("M")) {
        // Medium chart size
        width = 620;
        mainHeight = 215;
        indicatorHeight = 70;
    } else if (size.equals("H")) {
        // Huge chart size
        width = 1000;
        mainHeight = 320;
        indicatorHeight = 90;
    }

    // Create the chart object using the selected size
    FinanceChart m = new FinanceChart(width);

    // Set the data into the chart object
    m.setData(timeStamps, highData, lowData, openData, closeData, volData,
        extraPoints);

    //
    // We configure the title of the chart. In this demo chart design, we put the
    // company name as the top line of the title with left alignment.
    //
    m.addPlotAreaTitle(Chart.TopLeft, tickerKey);

    // We displays the current date as well as the data resolution on the next line.
    String resolutionText = "";
    if (resolution == 30 * 86400) {
        resolutionText = "Monthly";
    } else if (resolution == 7 * 86400) {
        resolutionText = "Weekly";
    } else if (resolution == 86400) {
        resolutionText = "Daily";
    } else if (resolution == 900) {
        resolutionText = "15-min";
    }

    m.addPlotAreaTitle(Chart.BottomLeft, "&lt;*font=Arial,size=8*&gt;" + m.formatValue(
        new Date(), "mmm dd, yyyy") + " - " + resolutionText + " chart");

    // A copyright message at the bottom left corner the title area
    m.addPlotAreaTitle(Chart.BottomRight,
        "&lt;*font=Arial,size=8*&gt;(c) Advanced Software Engineering");

    //
    // Add the first techical indicator according. In this demo, we draw the first
    // indicator on top of the main chart.
    //
    addIndicator(m, request.getParameter("Indicator1"), indicatorHeight);

    //
    // Add the main chart
    //
    m.addMainChart(mainHeight);

    //
    // Set log or linear scale according to user preference
    //
    if (request.getParameter("LogScale").equals("1")) {
        m.setLogScale(true);
    }

    //
    // Set axis labels to show data values or percentage change to user preference
    //
    if (request.getParameter("PercentageScale").equals("1")) {
        m.setPercentageAxis();
    }

    //
    // Draw any price line the user has selected
    //
    String mainType = request.getParameter("ChartType");
    if (mainType.equals("Close")) {
        m.addCloseLine(0x000040);
    } else if (mainType.equals("TP")) {
        m.addTypicalPrice(0x000040);
    } else if (mainType.equals("WC")) {
        m.addWeightedClose(0x000040);
    } else if (mainType.equals("Median")) {
        m.addMedianPrice(0x000040);
    }

    //
    // Add comparison line if there is data for comparison
    //
    if (compareData != null) {
        if (compareData.length &gt; extraPoints) {
            m.addComparison(compareData, 0x0000ff, compareKey);
        }
    }

    //
    // Add moving average lines.
    //
    addMovingAvg(m, request.getParameter("avgType1"), avgPeriod1, 0x663300);
    addMovingAvg(m, request.getParameter("avgType2"), avgPeriod2, 0x9900ff);

    //
    // Draw candlesticks or OHLC symbols if the user has selected them.
    //
    if (mainType.equals("CandleStick")) {
        m.addCandleStick(0x33ff33, 0xff3333);
    } else if (mainType.equals("OHLC")) {
        m.addHLOC(0x008800, 0xcc0000);
    }

    //
    // Add parabolic SAR if necessary
    //
    if (request.getParameter("ParabolicSAR").equals("1")) {
        m.addParabolicSAR(0.02, 0.02, 0.2, Chart.DiamondShape, 5, 0x008800, 0x000000)
            ;
    }

    //
    // Add price band/channel/envelop to the chart according to user selection
    //
    String bandType = request.getParameter("Band");
    if (bandType.equals("BB")) {
        m.addBollingerBand(20, 2, 0x9999ff, 0xc06666ff);
    } else if (bandType.equals("DC")) {
        m.addDonchianChannel(20, 0x9999ff, 0xc06666ff);
    } else if (bandType.equals("Envelop")) {
        m.addEnvelop(20, 0.1, 0x9999ff, 0xc06666ff);
    }

    //
    // Add volume bars to the main chart if necessary
    //
    if (request.getParameter("Volume").equals("1")) {
        m.addVolBars(indicatorHeight, 0x99ff99, 0xff9999, 0xc0c0c0);
    }

    //
    // Add additional indicators as according to user selection.
    //
    addIndicator(m, request.getParameter("Indicator2"), indicatorHeight);
    addIndicator(m, request.getParameter("Indicator3"), indicatorHeight);
    addIndicator(m, request.getParameter("Indicator4"), indicatorHeight);

    return m;
}

/// &lt;summary&gt;
/// Add a moving average line to the FinanceChart object.
/// &lt;/summary&gt;
/// &lt;param name="m"&gt;The FinanceChart object to add the line to.&lt;/param&gt;
/// &lt;param name="avgType"&gt;The moving average type (SMA/EMA/TMA/WMA).&lt;/param&gt;
/// &lt;param name="avgPeriod"&gt;The moving average period.&lt;/param&gt;
/// &lt;param name="color"&gt;The color of the line.&lt;/param&gt;
/// &lt;returns&gt;The LineLayer object representing line layer created.&lt;/returns&gt;
protected LineLayer addMovingAvg(FinanceChart m, String avgType, int avgPeriod,
    int color)
{
    if (avgPeriod &gt; 1) {
        if (avgType.equals("SMA")) {
            return m.addSimpleMovingAvg(avgPeriod, color);
        } else if (avgType.equals("EMA")) {
            return m.addExpMovingAvg(avgPeriod, color);
        } else if (avgType.equals("TMA")) {
            return m.addTriMovingAvg(avgPeriod, color);
        } else if (avgType.equals("WMA")) {
            return m.addWeightedMovingAvg(avgPeriod, color);
        }
    }
    return null;
}

/// &lt;summary&gt;
/// Add an indicator chart to the FinanceChart object. In this demo example, the
/// indicator parameters (such as the period used to compute RSI, colors of the lines,
/// etc.) are hard coded to commonly used values. You are welcome to design a more
/// complex user interface to allow users to set the parameters.
/// &lt;/summary&gt;
/// &lt;param name="m"&gt;The FinanceChart object to add the line to.&lt;/param&gt;
/// &lt;param name="indicator"&gt;The selected indicator.&lt;/param&gt;
/// &lt;param name="height"&gt;Height of the chart in pixels&lt;/param&gt;
/// &lt;returns&gt;The XYChart object representing indicator chart.&lt;/returns&gt;
protected XYChart addIndicator(FinanceChart m, String indicator, int height)
{
    if (indicator.equals("RSI")) {
        return m.addRSI(height, 14, 0x800080, 20, 0xff6666, 0x6666ff);
    } else if (indicator.equals("StochRSI")) {
        return m.addStochRSI(height, 14, 0x800080, 30, 0xff6666, 0x6666ff);
    } else if (indicator.equals("MACD")) {
        return m.addMACD(height, 26, 12, 9, 0x0000ff, 0xff00ff, 0x008000);
    } else if (indicator.equals("FStoch")) {
        return m.addFastStochastic(height, 14, 3, 0x006060, 0x606000);
    } else if (indicator.equals("SStoch")) {
        return m.addSlowStochastic(height, 14, 3, 0x006060, 0x606000);
    } else if (indicator.equals("ATR")) {
        return m.addATR(height, 14, 0x808080, 0x0000ff);
    } else if (indicator.equals("ADX")) {
        return m.addADX(height, 14, 0x008000, 0x800000, 0x000080);
    } else if (indicator.equals("DCW")) {
        return m.addDonchianWidth(height, 20, 0x0000ff);
    } else if (indicator.equals("BBW")) {
        return m.addBollingerWidth(height, 20, 2, 0x0000ff);
    } else if (indicator.equals("DPO")) {
        return m.addDPO(height, 20, 0x0000ff);
    } else if (indicator.equals("PVT")) {
        return m.addPVT(height, 0x0000ff);
    } else if (indicator.equals("Momentum")) {
        return m.addMomentum(height, 12, 0x0000ff);
    } else if (indicator.equals("Performance")) {
        return m.addPerformance(height, 0x0000ff);
    } else if (indicator.equals("ROC")) {
        return m.addROC(height, 12, 0x0000ff);
    } else if (indicator.equals("OBV")) {
        return m.addOBV(height, 0x0000ff);
    } else if (indicator.equals("AccDist")) {
        return m.addAccDist(height, 0x0000ff);
    } else if (indicator.equals("CLV")) {
        return m.addCLV(height, 0x0000ff);
    } else if (indicator.equals("WilliamR")) {
        return m.addWilliamR(height, 14, 0x800080, 30, 0xff6666, 0x6666ff);
    } else if (indicator.equals("Aroon")) {
        return m.addAroon(height, 14, 0x339933, 0x333399);
    } else if (indicator.equals("AroonOsc")) {
        return m.addAroonOsc(height, 14, 0x0000ff);
    } else if (indicator.equals("CCI")) {
        return m.addCCI(height, 20, 0x800080, 100, 0xff6666, 0x6666ff);
    } else if (indicator.equals("EMV")) {
        return m.addEaseOfMovement(height, 9, 0x006060, 0x606000);
    } else if (indicator.equals("MDX")) {
        return m.addMassIndex(height, 0x800080, 0xff6666, 0x6666ff);
    } else if (indicator.equals("CVolatility")) {
        return m.addChaikinVolatility(height, 10, 10, 0x0000ff);
    } else if (indicator.equals("COscillator")) {
        return m.addChaikinOscillator(height, 0x0000ff);
    } else if (indicator.equals("CMF")) {
        return m.addChaikinMoneyFlow(height, 21, 0x008000);
    } else if (indicator.equals("NVI")) {
        return m.addNVI(height, 255, 0x0000ff, 0x883333);
    } else if (indicator.equals("PVI")) {
        return m.addPVI(height, 255, 0x0000ff, 0x883333);
    } else if (indicator.equals("MFI")) {
        return m.addMFI(height, 14, 0x800080, 30, 0xff6666, 0x6666ff);
    } else if (indicator.equals("PVO")) {
        return m.addPVO(height, 26, 12, 9, 0x0000ff, 0xff00ff, 0x008000);
    } else if (indicator.equals("PPO")) {
        return m.addPPO(height, 26, 12, 9, 0x0000ff, 0xff00ff, 0x008000);
    } else if (indicator.equals("UO")) {
        return m.addUltimateOscillator(height, 7, 14, 28, 0x800080, 20, 0xff6666,
            0x6666ff);
    } else if (indicator.equals("Vol")) {
        return m.addVolIndicator(height, 0x99ff99, 0xff9999, 0xc0c0c0);
    } else if (indicator.equals("TRIX")) {
        return m.addTRIX(height, 12, 0x0000ff);
    }
    return null;
}

/// &lt;summary&gt;
/// Creates a dummy chart to show an error message.
/// &lt;/summary&gt;
/// &lt;param name="msg"&gt;The error message.
/// &lt;returns&gt;The BaseChart object containing the error message.&lt;/returns&gt;
protected BaseChart errMsg(String msg)
{
    MultiChart m = new MultiChart(400, 200);
    m.addTitle2(Chart.Center, msg, "Arial", 10).setMaxWidth(m.getWidth());
    return m;
}
%&gt;
&lt;%

// create the finance chart
BaseChart c = drawChart(request);

try
{
    // stream the chart to the browser and terminate immediately
    out.clear();
    if (WebChartViewer.streamChart(response, c.makeChart2(Chart.PNG)))
        return;
}
catch (IllegalStateException e)
{
    // Some very old servers may not support streaming. So we are forced to redirect
    // to the browser to use the traditional method.
    response.sendRedirect(response.encodeRedirectURL("getchart.jsp?" +
        c.makeSession(request, "chart1")));
    return;
}

%&gt;</pre></tr></td></table><br>
</div><p class="heading1a">Interactive Financial Chart as Standalone Application</p><div class="content">
The standalone Interactive Financial Chart is based on SWING user interface. The code can be roughly divided into 3 main parts.<br><br>
<ul>
<li>The first part of the code is to initialize the user interface.<br><br>
<li>The second part of the code is the get15MinData, getDailyData, getWeeklyData and getMonthlyData functions, which are for retrieving stock data. In this example, they just retrieve data from a random number generator. You may replace the code in these functions with your own code to get data from your data source.<br><br>
<li>The third part of the code is the drawChart function. This is the real charting code, which creates a <a href="FinanceChart.htm">FinanceChart</a> object, set data to it, and configures it according to the states of the user controls.<br><br>
</ul>
<b>[Java Version]</b> javademo/FinanceDemo.java
<table width="98%" border="0" cellpadding="10"><tr><td bgcolor="#cccccc"><pre>import ChartDirector.*;
import java.util.*;
import javax.swing.*;
import java.awt.*;
import java.awt.event.*;

public class FinanceDemo extends JFrame implements DemoModule
{
    // The ticker symbol, timeStamps, volume, high, low, open and close data    
    String tickerKey = "";
    private Date[] timeStamps;  
    private double[] volData;       //The volume values.
    private double[] highData;      //The high values.
    private double[] lowData;       //The low values.
    private double[] openData;      //The open values.
    private double[] closeData;     //The close values.

    // An extra data series to compare with the close data
    String compareKey = "";
    double[] compareData = null;

    // The resolution of the data in seconds. 1 day = 86400 seconds.
    int resolution = 86400;
 
    // The moving average periods
    private int avgPeriod1;
    private int avgPeriod2;

    // Will set to true at the end of initialization
    private boolean hasFinishedInitialization;
    
    //
    // Controls in the JFrame
    //
    private JTextField tickerSymbol;
    private JTextField compareWith;
    private JComboBox timeRange;
    private JComboBox chartSize;
    private JCheckBox volumeBars;
    private JCheckBox parabolicSAR;
    private JCheckBox logScale;
    private JCheckBox percentageScale;
    private JComboBox chartType;
    private JComboBox priceBand;
    private JComboBox avgType1;
    private JTextField movAvg1;
    private JComboBox avgType2;
    private JTextField movAvg2;
    private JComboBox indicator1;
    private JComboBox indicator2;
    private JComboBox indicator3;
    private JComboBox indicator4;
     private ChartViewer chartViewer1;
  
    /// &lt;summary&gt;
    /// A utility class for adding items to ComboBox
    /// &lt;/summary&gt;
    private static class ListItem
    {
        private String m_key;
        private String m_value;

        private ListItem(String key, String val)
        {
            m_key = key;
            m_value = val;
        }

        private String getKey()
        {
            return m_key;
        }

        public String toString()
        {
            return m_value;
        }
    }
        
    /// &lt;summary&gt;
    /// The main method to allow this demo to run as a standalone program.
    /// &lt;/summary&gt;
    public static void main(String args[]) 
    {
        FinanceDemo d = new FinanceDemo();
        d.initComponents(true);
        d.setVisible(true);
    }
    
    /// &lt;summary&gt;
    /// Create the JFrame and put controls in it. 
    /// &lt;/summary&gt;
    private void initComponents(boolean closeOnExit) 
    {
        // Do nothing if already initialized
        if (hasFinishedInitialization)
            return;
        
        setTitle("ChartDirector Financial Chart Demonstration");

        // End application upon closing main window
        if (closeOnExit)
        {
            addWindowListener(new WindowAdapter() {
                public void windowClosing(WindowEvent e) {System.exit(0);} });
        }

        // Top label bar
        JLabel topLabel = new JLabel("Advanced Software Engineering");
        topLabel.setForeground(new java.awt.Color(255, 255, 51));
        topLabel.setBackground(new java.awt.Color(0, 0, 128));
        topLabel.setBorder(new javax.swing.border.EmptyBorder(2, 0, 2, 5));
        topLabel.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        topLabel.setOpaque(true);
        getContentPane().add(topLabel, java.awt.BorderLayout.NORTH);

        // Left panel
        JPanel leftPanel = new JPanel(null);

        // Ticker Symbol
        leftPanel.add(new JLabel("Ticker Symbol")).setBounds(8, 4, 140, 18);
        tickerSymbol = new JTextField("ASE.SYMBOL");
        leftPanel.add(tickerSymbol).setBounds(8, 22, 140, 20);
        
        // Compare With
        leftPanel.add(new JLabel("Compare With")).setBounds(8, 46, 140, 18);
        compareWith = new JTextField();
        leftPanel.add(compareWith).setBounds(8, 64, 140, 20);

        // Time Period
        leftPanel.add(new JLabel("Time Period")).setBounds(8, 88, 140, 18);
        timeRange = new JComboBox();
        leftPanel.add(timeRange).setBounds(8, 106, 140, 20);
        
        // Chart Size
        leftPanel.add(new JLabel("Chart Size")).setBounds(8, 130, 140, 18);
        chartSize = new JComboBox();
        leftPanel.add(chartSize).setBounds(8, 148, 140, 20);

        // Value bars/Log Scale/Grid Lines
        volumeBars = new JCheckBox("Show Volume Bars", true);
        parabolicSAR = new JCheckBox("Parabolic SAR", false);
        logScale = new JCheckBox("Log Scale", false);
        percentageScale = new JCheckBox("Percentage Grid", false);
        leftPanel.add(volumeBars).setBounds(8, 172, 140, 20);
        leftPanel.add(parabolicSAR).setBounds(8, 192, 140, 20);
        leftPanel.add(logScale).setBounds(8, 212, 140, 20);
        leftPanel.add(percentageScale).setBounds(8, 232, 140, 20);
         
        // Chart Type
        leftPanel.add(new JLabel("Chart Type")).setBounds(8, 256, 140, 18);
        chartType = new JComboBox();
        leftPanel.add(chartType).setBounds(8, 274, 140, 20);

        // Price Bands
        leftPanel.add(new JLabel("Price Bands")).setBounds(8, 298, 140, 18);
        priceBand = new JComboBox();
        leftPanel.add(priceBand).setBounds(8, 316, 140, 20);
        
        // Moving Averages
        leftPanel.add(new JLabel("Moving Averages")).setBounds(8, 340, 140, 18);
        avgType1 = new JComboBox();
        avgType2 = new JComboBox();
        movAvg1 = new JTextField("10");
        movAvg2 = new JTextField("25");
        leftPanel.add(avgType1).setBounds(8, 358, 105, 20);
        leftPanel.add(avgType2).setBounds(8, 378, 105, 20);
        leftPanel.add(movAvg1).setBounds(113, 358, 35, 20);
        leftPanel.add(movAvg2).setBounds(113, 378, 35, 20);

        // Technical Indicators
        leftPanel.add(new JLabel("Technical Indicators")).setBounds(8, 402, 140, 18);
        indicator1 = new JComboBox();
        indicator2 = new JComboBox();
        indicator3 = new JComboBox();
        indicator4 = new JComboBox();
        leftPanel.add(indicator1).setBounds(8, 420, 140, 20);
        leftPanel.add(indicator2).setBounds(8, 440, 140, 20);
        leftPanel.add(indicator3).setBounds(8, 460, 140, 20);
        leftPanel.add(indicator4).setBounds(8, 480, 140, 20);

        // Put Left Panel in a scroll pane
        leftPanel.setPreferredSize(new Dimension(150, 510));
        JScrollPane leftScrollPane = new JScrollPane(leftPanel, 
            JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED, JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
        leftScrollPane.setPreferredSize(new Dimension(170, 515));
        
        // Chart Viewer
        chartViewer1 = new ChartViewer();
        chartViewer1.setBackground(new java.awt.Color(255, 255, 255));
        chartViewer1.setHorizontalAlignment(SwingConstants.CENTER);
        chartViewer1.setOpaque(true);
        
        // Put Chart Viewer in a scroll pane
        JScrollPane rightScrollPane = new JScrollPane(chartViewer1);
        rightScrollPane.setPreferredSize(new Dimension(800, 490));

        // Put the LeftPanel and RightScrollPane on the JFrame
        getContentPane().add(leftScrollPane, java.awt.BorderLayout.WEST);
        getContentPane().add(rightScrollPane, java.awt.BorderLayout.CENTER);

        // Font to use for user interface elements
        Font controlFont = new Font("Dialog", Font.PLAIN, 11);
        Font labelFont = new Font("Dialog", Font.BOLD, 11);
        
        // Use the same action hanlder for all controls
        ActionListener actionHandler = new ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                handleSelection(evt); }};
                
        // Text field connects to the textChangeHandler for validating the text
        FocusAdapter textChangeHandler = new FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                textChanged(evt); }};

        for (int i = 0; i &lt; leftPanel.getComponentCount(); ++i)
        {
            // Set all UI fonts (except labels) to uiFont
            Component c = leftPanel.getComponent(i);
            if (!(c instanceof JLabel))
                c.setFont(controlFont);
            else
                c.setFont(labelFont);
            
            // Connect controls to event handlers
            if (c instanceof JComboBox)
                ((JComboBox)c).addActionListener(actionHandler);
            if (c instanceof JCheckBox)
                ((JCheckBox)c).addActionListener(actionHandler);
            if (c instanceof JTextField)
            {
                ((JTextField)c).addActionListener(actionHandler);
                ((JTextField)c).addFocusListener(textChangeHandler);
            }
        }
        
        //
        // Fill the contents of the combo boxes
        //

        timeRange.setModel(new DefaultComboBoxModel(new ListItem[]
        {
             new ListItem("1", "1 day"),
             new ListItem("2", "2 days"),
             new ListItem("5", "5 days"),
             new ListItem("10", "10 days"),
             new ListItem("30", "1 month"),
             new ListItem("60", "2 months"),
             new ListItem("90", "3 months"),
             new ListItem("180", "6 months"),
             new ListItem("360", "1 year"),
             new ListItem("720", "2 years"),
             new ListItem("1080", "3 years"),
             new ListItem("1440", "4 years"),
             new ListItem("1800", "5 years"),
             new ListItem("3600", "10 years")
        }));
        timeRange.setSelectedIndex(7);
        
        chartSize.setModel(new DefaultComboBoxModel(new ListItem[]
        {
             new ListItem("S", "Small"),
             new ListItem("M", "Medium"),
             new ListItem("L", "Large"),
             new ListItem("H", "Huge")
        }));
        chartSize.setSelectedIndex(2);
        
        chartType.setModel(new DefaultComboBoxModel(new ListItem[]
        {
             new ListItem("None", "None"),
             new ListItem("CandleStick", "CandleStick"),
             new ListItem("Close", "Closing Price"),
             new ListItem("Median", "Median Price"),
             new ListItem("OHLC", "OHLC"),
             new ListItem("TP", "Typical Price"),
             new ListItem("WC", "Weighted Close")
        }));
        chartType.setSelectedIndex(1);

        priceBand.setModel(new DefaultComboBoxModel(new ListItem[]
         {
             new ListItem("None", "None"),
             new ListItem("BB", "Bollinger Band"),
             new ListItem("DC", "Donchain Channel"),
             new ListItem("Envelop", "Envelop (SMA 20 +/- 10%)")
         }));
        priceBand.setSelectedIndex(1);
            
        avgType1.setModel(new DefaultComboBoxModel(new ListItem[]
        {
            new ListItem("None", "None"),
            new ListItem("SMA", "Simple"),
            new ListItem("EMA", "Exponential"),
            new ListItem("TMA", "Triangular"),
            new ListItem("WMA", "Weighted")
        }));
        avgType1.setSelectedIndex(1);

        avgType2.setModel(new DefaultComboBoxModel(new ListItem[]
        {
            new ListItem("None", "None"),
            new ListItem("SMA", "Simple"),
            new ListItem("EMA", "Exponential"),
            new ListItem("TMA", "Triangular"),
            new ListItem("WMA", "Weighted")
        }));
        avgType2.setSelectedIndex(1);
        
        ListItem[] indicators = 
        {
            new ListItem("None", "None"),
            new ListItem("AccDist", "Accumulation/Distribution"),
            new ListItem("AroonOsc", "Aroon Oscillator"),
            new ListItem("Aroon", "Aroon Up/Down"),
            new ListItem("ADX", "Avg Directional Index"),
            new ListItem("ATR", "Avg True Range"),
            new ListItem("BBW", "Bollinger Band Width"),
            new ListItem("CMF", "Chaikin Money Flow"),
            new ListItem("COscillator", "Chaikin Oscillator"),
            new ListItem("CVolatility", "Chaikin Volatility"),
            new ListItem("CLV", "Close Location Value"),
            new ListItem("CCI", "Commodity Channel Index"),
            new ListItem("DPO", "Detrended Price Osc"),
            new ListItem("DCW", "Donchian Channel Width"),
            new ListItem("EMV", "Ease of Movement"),
            new ListItem("FStoch", "Fast Stochastic"),
            new ListItem("MACD", "MACD"),
            new ListItem("MDX", "Mass Index"),
            new ListItem("Momentum", "Momentum"),
            new ListItem("MFI", "Money Flow Index"),
            new ListItem("NVI", "Neg Volume Index"),
            new ListItem("OBV", "On Balance Volume"),
            new ListItem("Performance", "Performance"),
            new ListItem("PPO", "% Price Oscillator"),
            new ListItem("PVO", "% Volume Oscillator"),
            new ListItem("PVI", "Pos Volume Index"),
            new ListItem("PVT", "Price Volume Trend"),
            new ListItem("ROC", "Rate of Change"),
            new ListItem("RSI", "RSI"),
            new ListItem("SStoch", "Slow Stochastic"),
            new ListItem("StochRSI", "StochRSI"),
            new ListItem("TRIX", "TRIX"),
            new ListItem("UO", "Ultimate Oscillator"),
            new ListItem("Vol", "Volume"),
            new ListItem("WilliamR", "William's %R")
        };

        indicator1.setModel(new DefaultComboBoxModel(indicators));
        indicator2.setModel(new DefaultComboBoxModel(indicators));
        indicator3.setModel(new DefaultComboBoxModel(indicators));
        indicator4.setModel(new DefaultComboBoxModel(indicators));

        for (int i = 0; i &lt; indicators.length; ++i)
        {
            if (indicators[i].getKey() == "RSI")
                indicator1.setSelectedIndex(i);
            else if (indicators[i].getKey() == "MACD")
                indicator2.setSelectedIndex(i);
        }
        indicator3.setSelectedIndex(0);
        indicator4.setSelectedIndex(0);
        
        // Layout and display the JFrame
        pack();
        hasFinishedInitialization = true;
         
        // Update the chart
        drawChart(chartViewer1);
    }
    
    /// &lt;summary&gt;
    /// Get the timeStamps, highData, lowData, openData, closeData and volData.
    /// &lt;/summary&gt;
    /// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
    /// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
    /// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
    /// &lt;param name="durationInDays"&gt;The number of trading days to get.&lt;/param&gt;
    /// &lt;param name="extraPoints"&gt;The extra leading data points needed in order to
    /// compute moving averages.&lt;/param&gt;
    /// &lt;returns&gt;True if successfully obtain the data, otherwise false.&lt;/returns&gt;
    protected boolean getData(String ticker, GregorianCalendar startDate,
        GregorianCalendar endDate, int durationInDays, int extraPoints)
    {
        // This method should return false if the ticker symbol is invalid. In this
        // sample code, as we are using a random number generator for the data, all
        // ticker symbol is allowed, but we still assumed an empty symbol is invalid.
        if (ticker.equals("")) {
            return false;
        }

        // In this demo, we can get 15 min, daily, weekly or monthly data depending on
        // the time range.
        resolution = 86400;
        if (durationInDays &lt;= 10) {
            // 10 days or less, we assume 15 minute data points are available
            resolution = 900;

            // We need to adjust the startDate backwards for the extraPoints. We assume
            // 6.5 hours trading time per day, and 5 trading days per week.
            double dataPointsPerDay = 6.5 * 3600 / resolution;
            GregorianCalendar adjustedStartDate = new GregorianCalendar(startDate.get(Calendar.YEAR),
                startDate.get(Calendar.MONTH), startDate.get(Calendar.DAY_OF_MONTH));
            adjustedStartDate.add(Calendar.DAY_OF_MONTH,
                -(int)Math.ceil(extraPoints / dataPointsPerDay * 7 / 5) - 2);

            // Get the required 15 min data
            get15MinData(ticker, adjustedStartDate.getTime(), endDate.getTime());

        } else if (durationInDays &gt;= 4.5 * 360) {
            // 4 years or more - use monthly data points.
            resolution = 30 * 86400;

            // Adjust startDate backwards to cater for extraPoints
            GregorianCalendar adjustedStartDate = (GregorianCalendar)startDate.clone();
            adjustedStartDate.add(Calendar.MONTH, -extraPoints);

            // Get the required monthly data
            getMonthlyData(ticker, adjustedStartDate.getTime(), endDate.getTime());

        } else if (durationInDays &gt;= 1.5 * 360) {
            // 1 year or more - use weekly points.
            resolution = 7 * 86400;

            // Adjust startDate backwards to cater for extraPoints
            GregorianCalendar adjustedStartDate = (GregorianCalendar)startDate.clone();
                adjustedStartDate.add(Calendar.DAY_OF_MONTH, -extraPoints * 7 - 6);

            // Get the required weekly data
            getWeeklyData(ticker, adjustedStartDate.getTime(), endDate.getTime());

        } else {
            // Default - use daily points
            resolution = 86400;

            // Adjust startDate backwards to cater for extraPoints. We multiply the days
            // by 7/5 as we assume 1 week has 5 trading days.
            GregorianCalendar adjustedStartDate = new GregorianCalendar(startDate.get(Calendar.YEAR),
                startDate.get(Calendar.MONTH), startDate.get(Calendar.DAY_OF_MONTH));
            adjustedStartDate.add(Calendar.DAY_OF_MONTH, - (extraPoints * 7 + 4) / 5 - 2);
          
            // Get the required daily data
            getDailyData(ticker, adjustedStartDate.getTime(), endDate.getTime());
        }

        return true;
    }

    /// &lt;summary&gt;
    /// Get 15 minutes data series for timeStamps, highData, lowData, openData, closeData
    /// and volData.
    /// &lt;/summary&gt;
    /// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
    /// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
    /// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
    private void get15MinData(String ticker, Date startDate, Date endDate)
    {
        //
        // In this demo, we use a random number generator to generate the data. In practice,
        // you may get the data from a database or by other means. If you do not have 15 
        // minute data, you may modify the "drawChart" method below to not using 15 minute
        // data.
        //
        generateRandomData(ticker, startDate, endDate, 900);
    }

    /// &lt;summary&gt;
    /// Get daily data series for timeStamps, highData, lowData, openData, closeData
    /// and volData.
    /// &lt;/summary&gt;
    /// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
    /// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
    /// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
    private void getDailyData(String ticker, Date startDate, Date endDate)
    {
        //
        // In this demo, we use a random number generator to generate the data. In practice,
        // you may get the data from a database or by other means. A typical database code
        // example is like below. (This only shows a general idea. The exact details may differ
        // depending on your database brand and schema.)
        //
        //   //Connect to database using a suitable JDBC driver and the connect string
        //   Class.forName("sun.jdbc.odbc.JdbcOdbcDriver");
        //   java.sql.Connection dbConn = java.sql.DriverManager.getConnection
        //        ("jdbc:odbc:Driver={Microsoft Access Driver (*.mdb)};DBQ=example.mdb");
        //
        //   //SQL statement to get the data. We use prepared statements in the example as it
        //   //offers a portable way to handle date/time formats.
        //   String sql = "Select recordDate, highData, lowData, openData, closeDate, volData " + 
        //       "From dailyFinanceTable Where ticker = '" + ticker + "' And recordDate &gt;= ? " +
        //       " And recordDate &lt;= ? Order By recordDate";
        //   java.sql.PreparedStatement stmt = dbConn.prepareStatement(sql);
        //   stmt.setDate(1, new java.sql.Date(startDate.getTime()));
        //   stmt.setDate(2, new java.sql.Date(endDate.getTime()));
        //
        //   //The most convenient way to read the SQL result into arrays is to use the 
        //   //ChartDirector DBTable utility.
        //   DBTable table = new DBTable(stmt.executeQuery());
        //   stmt.close();
        //   dbConn.close();
        //
        //   //Now get the data into arrays
        //   timeStamps = table.getColAsDateTime(0);
        //   highData = table.getCol(1);
        //   lowData = table.getCol(2);
        //   openData = table.getCol(3);
        //   closeData = table.getCol(4);
        //   volData = table.getCol(5);
        //
        
        generateRandomData(ticker, startDate, endDate, 86400);
    }

    /// &lt;summary&gt;
    /// Get weekly data series for timeStamps, highData, lowData, openData, closeData
    /// and volData.
    /// &lt;/summary&gt;
    /// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
    /// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
    /// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
    private void getWeeklyData(String ticker, Date startDate, Date endDate)
    {
        //
        // In this demo, we use a random number generator to generate the data. In practice,
        // you may get the data from a database or by other means. If you do not have weekly
        // data, you may call "getDailyData" to get daily data first, and then call 
        // "convertDailyToWeeklyData" to convert it to weekly data, like:
        //
        //      getDailyData(startDate, endDate);
        //      convertDailyToWeeklyData();
        //
        generateRandomData(ticker, startDate, endDate, 86400 * 7);
    }

    /// &lt;summary&gt;
    /// Get monthly data series for timeStamps, highData, lowData, openData, closeData
    /// and volData.
    /// &lt;/summary&gt;
    /// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
    /// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
    /// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
    private void getMonthlyData(String ticker, Date startDate, Date endDate)
    {
        //
        // In this demo, we use a random number generator to generate the data. In practice,
        // you may get the data from a database or by other means. If you do not have monthly
        // data, you may call "getDailyData" to get daily data first, and then call 
        // "convertDailyToMonthlyData" to convert it to monthly data, like:
        //
        //      getDailyData(startDate, endDate);
        //      convertDailyToMonthlyData();
        //
        generateRandomData(ticker, startDate, endDate, 86400 * 30);
    }

    /// &lt;summary&gt;
    /// A random number generator designed to generate realistic financial data.
    /// &lt;/summary&gt;
    /// &lt;param name="ticker"&gt;The ticker symbol for the data series.&lt;/param&gt;
    /// &lt;param name="startDate"&gt;The starting date/time for the data series.&lt;/param&gt;
    /// &lt;param name="endDate"&gt;The ending date/time for the data series.&lt;/param&gt;
    /// &lt;param name="resolution"&gt;The period of the data series.&lt;/param&gt;
    private void generateRandomData(String ticker, Date startDate, Date endDate, int resolution)
    {
        FinanceSimulator db = new FinanceSimulator(ticker, startDate, endDate, resolution);
        timeStamps = db.getTimeStamps();
        highData = db.getHighData();
        lowData = db.getLowData();
        openData = db.getOpenData();
        closeData = db.getCloseData();
        volData = db.getVolData();
    }

    /// &lt;summary&gt;
    /// A utility to convert daily to weekly data.
    /// &lt;/summary&gt;
    private void convertDailyToWeeklyData()
    {
        aggregateData(new ArrayMath(timeStamps).selectStartOfWeek());
    }
        
    /// &lt;summary&gt;
    /// A utility to convert daily to monthly data.
    /// &lt;/summary&gt;
    private void convertDailyToMonthlyData()
    {
        aggregateData(new ArrayMath(timeStamps).selectStartOfMonth());
    }

    /// &lt;summary&gt;
    /// An internal method used to aggregate daily data.
    /// &lt;/summary&gt;
    private void aggregateData(ArrayMath aggregator)
    {
        timeStamps = Chart.NTime(aggregator.aggregate(Chart.CTime(timeStamps), Chart.AggregateFirst));
        highData = aggregator.aggregate(highData, Chart.AggregateMax);
        lowData = aggregator.aggregate(lowData, Chart.AggregateMin);
        openData = aggregator.aggregate(openData, Chart.AggregateFirst);
        closeData = aggregator.aggregate(closeData, Chart.AggregateLast);
        volData = aggregator.aggregate(volData, Chart.AggregateSum);
    }    
    
    /// &lt;summary&gt;
    /// Handler for modifications to the text boxes
    /// &lt;/summary&gt;
   private void textChanged(java.awt.event.FocusEvent evt) 
    {
        //
        // Redraw chart if the text box is changed
        //
        
           JTextField src = (JTextField)evt.getSource();
        
        int period;
        try { period = Integer.parseInt(src.getText()); }
        catch (NumberFormatException e) { period = 0; }

        if (((src == tickerSymbol) && !tickerSymbol.getText().trim().equals(tickerKey)) ||
            ((src == compareWith) && !compareWith.getText().trim().equals(compareKey)) ||
            ((src == movAvg1) && (period != avgPeriod1)) ||
            ((src == movAvg2) && (period != avgPeriod2)))
            drawChart(chartViewer1);
    }

    /// &lt;summary&gt;
    /// Handler for the actionPerformed event for the controls
    /// &lt;/summary&gt;
    private void handleSelection(java.awt.event.ActionEvent evt) 
    {
        if (hasFinishedInitialization)
            drawChart(chartViewer1);
    }
        
    /// &lt;summary&gt;
    /// Draw the chart according to user selection and display it in the WebChartViewer.
    /// &lt;/summary&gt;
    /// &lt;param name="viewer"&gt;The ChartViewer object to display the chart.&lt;/param&gt;
    private void drawChart(ChartViewer viewer)
    {
        // In this demo, we just assume we plot up to the latest time. So endDate is now.
        GregorianCalendar endDate = new GregorianCalendar();

        // If the trading day has not yet started (before 9:30am), or if the end date is on
        // on Sat or Sun, we set the end date to 4:00pm of the last trading day        
        while ((endDate.get(Calendar.HOUR_OF_DAY) * 60 + endDate.get(Calendar.MINUTE) &lt; 
            9 * 60 + 30) || (endDate.get(Calendar.DAY_OF_WEEK) == Calendar.SUNDAY) ||
            (endDate.get(Calendar.DAY_OF_WEEK) == Calendar.SATURDAY))
        {
            endDate.add(Calendar.DAY_OF_MONTH, -1);
            endDate.set(Calendar.HOUR_OF_DAY, 16);
            endDate.set(Calendar.MINUTE, 0);
            endDate.set(Calendar.SECOND, 0);
        }
            
        // The duration selected by the user
        int durationInDays = Integer.parseInt(((ListItem)timeRange.getSelectedItem()).getKey());

        // Compute the start date by subtracting the duration from the end date.
        GregorianCalendar startDate;
        if (durationInDays &gt;= 30)
        {
            // More or equal to 30 days - so we use months as the unit
            startDate = new GregorianCalendar(endDate.get(Calendar.YEAR), endDate.get(Calendar.MONTH), 1);
            startDate.add(Calendar.MONTH, -durationInDays / 30);
        }
        else
        {
            // Less than 30 days - use day as the unit. The starting point of the axis is
            // always at the start of the day (9:30am). Note that we use trading days, so
            // we skip Sat and Sun in counting the days.
            startDate = new GregorianCalendar(endDate.get(Calendar.YEAR), endDate.get(Calendar.MONTH),
                endDate.get(Calendar.DAY_OF_MONTH), 9, 30, 0);
            for (int i = 1; i &lt; durationInDays; ++i)
                startDate.add(Calendar.DAY_OF_MONTH, (startDate.get(Calendar.DAY_OF_WEEK) == Calendar.MONDAY) ? -3 : -1);
        }

        // The moving average periods selected by the user.
        int avgPeriod1;
        try { avgPeriod1 = Integer.parseInt(movAvg1.getText()); }
        catch (NumberFormatException e) { avgPeriod1 = 0;}
        int avgPeriod2;
        try { avgPeriod2 = Integer.parseInt(movAvg2.getText()); }
        catch (NumberFormatException e) { avgPeriod2 = 0;}

        avgPeriod1 = Math.max(0, Math.min(300, avgPeriod1));
        avgPeriod2 = Math.max(0, Math.min(300, avgPeriod2));
            
        // We need extra leading data points in order to compute moving averages.
        int extraPoints = Math.max(20, Math.max(avgPeriod1, avgPeriod2));

        // Get the data series to compare with, if any.
        compareKey = compareWith.getText().trim();
        compareData = null;
        if (getData(compareKey, startDate, endDate, durationInDays, extraPoints)) 
            compareData = closeData;

        // The data series we want to get.
        tickerKey = tickerSymbol.getText().trim();
        if (!getData(tickerKey, startDate, endDate, durationInDays, extraPoints)) 
        {
            errMsg(viewer, "Please enter a valid ticker symbol");
            return;
        }
        
        // We now confirm the actual number of extra points (data points that are before
        // the start date) as inferred using actual data from the database.
        extraPoints = timeStamps.length;
        Date cutOff = startDate.getTime();
        for (int i = 0; i &lt; timeStamps.length; ++i)
        {
            if (!timeStamps[i].before(cutOff))
            {
                extraPoints = i;
                break;
            }
        }

        // Check if there is any valid data
        if (extraPoints &gt;= timeStamps.length)
        {
            // No data - just display the no data message.
            errMsg(viewer, "No data available for the specified time period");
            return;
        }

        // In some finance chart presentation style, even if the data for the latest day 
        // is not fully available, the axis for the entire day will still be drawn, where
        // no data will appear near the end of the axis.
        if (resolution &lt;= 86400)
        {
            // Add extra points to the axis until it reaches the end of the day. The end
            // of day is assumed to be 4:00pm (it depends on the stock exchange).
            GregorianCalendar lastTime = new GregorianCalendar();
            lastTime.setTime(timeStamps[timeStamps.length - 1]);
            int extraTrailingPoints = (int)((16 * 3600 - lastTime.get(Calendar.HOUR_OF_DAY) * 3600 
                - lastTime.get(Calendar.MINUTE) * 60 - lastTime.get(Calendar.SECOND)) / resolution);
            if (extraTrailingPoints &gt; 0)
            {
                Date[] extendedTimeStamps = new Date[timeStamps.length + extraTrailingPoints];
                System.arraycopy(timeStamps, 0, extendedTimeStamps, 0, timeStamps.length);
                for (int i = 0; i &lt; extraTrailingPoints; ++i)
                {
                    lastTime.add(Calendar.SECOND, resolution);
                    extendedTimeStamps[i + timeStamps.length] = (Date)lastTime.getTime().clone();
                }
                timeStamps = extendedTimeStamps;
            }               
        }

        //
        // At this stage, all data is available. We can draw the chart as according to 
        // user input.
        //

        //
        // Determine the chart size. In this demo, user can select 4 different chart sizes.
        // Default is the large chart size.
        //
        int width = 780;
        int mainHeight = 255;
        int indicatorHeight = 80;
        
        String selectedSize = ((ListItem)chartSize.getSelectedItem()).getKey();
        if (selectedSize == "S")
        {
            // Small chart size
            width = 450;
            mainHeight = 160;
            indicatorHeight = 60;
        }
        else if (selectedSize == "M")
        {
            // Medium chart size
            width = 620;
            mainHeight = 215;
            indicatorHeight = 70;
        }
        else if (selectedSize == "H")
        {
            // Huge chart size
            width = 1000;
            mainHeight = 320;
            indicatorHeight = 90;
        }

        // Create the chart object using the selected size
        FinanceChart m = new FinanceChart(width);

        // Set the data into the chart object
        m.setData(timeStamps, highData, lowData, openData, closeData, volData, extraPoints);

        //
        // We configure the title of the chart. In this demo chart design, we put the 
        // company name as the top line of the title with left alignment.
        //
        m.addPlotAreaTitle(Chart.TopLeft, tickerKey);

        // We displays the current date as well as the data resolution on the next line.
        String resolutionText = "";
        if (resolution == 30 * 86400)
            resolutionText = "Monthly";
        else if (resolution == 7 * 86400)
            resolutionText = "Weekly";
        else if (resolution == 86400)
            resolutionText = "Daily";
        else if (resolution == 900)
            resolutionText = "15-min";
       
        m.addPlotAreaTitle(Chart.BottomLeft, "&lt;*font=arial.ttf,size=8*&gt;" 
            + m.formatValue(new Date(), "mmm dd, yyyy") + " - " + resolutionText + " chart");

        // A copyright message at the bottom left corner the title area
        m.addPlotAreaTitle(Chart.BottomRight, "&lt;*font=arial.ttf,size=8*&gt;(c) Advanced Software Engineering");

        //
        // Add the first techical indicator according. In this demo, we draw the first
        // indicator on top of the main chart.
        //
        addIndicator(m, ((ListItem)indicator1.getSelectedItem()).getKey(), indicatorHeight);

        //
        // Add the main chart
        //
        m.addMainChart(mainHeight);

        //
        // Set log or linear scale according to user preference
        //
        m.setLogScale(logScale.isSelected());

        //
        // Set axis labels to show data values or percentage change to user preference
        //
        if (percentageScale.isSelected())
            m.setPercentageAxis();

        //
        // Draw the main chart depending on the chart type the user has selected
        //
        String selectedType = ((ListItem)chartType.getSelectedItem()).getKey();
        if (selectedType == "Close")
            m.addCloseLine(0x000040);
        else if (selectedType == "TP")
            m.addTypicalPrice(0x000040);
        else if (selectedType == "WC")
            m.addWeightedClose(0x000040);
        else if (selectedType == "Median")
            m.addMedianPrice(0x000040);

        //
        // Add comparison line if there is data for comparison
        //
        if (compareData != null) {
            if (compareData.length &gt; extraPoints) {
                m.addComparison(compareData, 0x0000ff, compareKey);
            }
        }

        //
        // Add moving average lines.
        //
        addMovingAvg(m, ((ListItem)avgType1.getSelectedItem()).getKey(), avgPeriod1, 0x663300);
        addMovingAvg(m, ((ListItem)avgType2.getSelectedItem()).getKey(), avgPeriod2, 0x9900ff);

        //
        // Draw the main chart if the user has selected CandleStick or OHLC. We draw it
        // here to make sure it is drawn behind the moving average lines (that is, the
        // moving average lines stay on top.)
        //
        if (selectedType == "CandleStick")
            m.addCandleStick(0x33ff33, 0xff3333);
        else if (selectedType == "OHLC")
            m.addHLOC(0x8000, 0x800000);

        //
        // Add parabolic SAR if necessary
        //
        if (parabolicSAR.isSelected())
            m.addParabolicSAR(0.02, 0.02, 0.2, Chart.DiamondShape, 5, 0x008800, 0x000000);

        //
        // Add price band/channel/envelop to the chart according to user selection
        //
        String selectedBand = ((ListItem)priceBand.getSelectedItem()).getKey();
        if (selectedBand == "BB")
            m.addBollingerBand(20, 2, 0x9999ff, 0xc06666ff);
        else if (selectedBand == "DC")
            m.addDonchianChannel(20, 0x9999ff, 0xc06666ff);
        else if (selectedBand == "Envelop")
            m.addEnvelop(20, 0.1, 0x9999ff, 0xc06666ff);

        //
        // Add volume bars to the main chart if necessary
        //
        if (volumeBars.isSelected())
            m.addVolBars(indicatorHeight, 0x99ff99, 0xff9999, 0xc0c0c0);

        //
        // Add additional indicators as according to user selection.
        //
        addIndicator(m, ((ListItem)indicator2.getSelectedItem()).getKey(), indicatorHeight);
        addIndicator(m, ((ListItem)indicator3.getSelectedItem()).getKey(), indicatorHeight);
        addIndicator(m, ((ListItem)indicator4.getSelectedItem()).getKey(), indicatorHeight);

        // Output chart to ChartViewer
        viewer.setImage(m.makeImage());
        viewer.setImageMap(m.getHTMLImageMap("", "", "title='" + m.getToolTipDateFormat() + 
            " {value|P}'"));
    }

    /// &lt;summary&gt;
    /// Add a moving average line to the FinanceChart object.
    /// &lt;/summary&gt;
    /// &lt;param name="m"&gt;The FinanceChart object to add the line to.&lt;/param&gt;
    /// &lt;param name="avgType"&gt;The moving average type (SMA/EMA/TMA/WMA).&lt;/param&gt;
    /// &lt;param name="avgPeriod"&gt;The moving average period.&lt;/param&gt;
    /// &lt;param name="color"&gt;The color of the line.&lt;/param&gt;
    protected LineLayer addMovingAvg(FinanceChart m, String avgType, int avgPeriod, int color)
    {
        if (avgPeriod &gt; 1)
        {
            if (avgType == "SMA")
                return m.addSimpleMovingAvg(avgPeriod, color);
            else if (avgType == "EMA")
                return m.addExpMovingAvg(avgPeriod, color);
            else if (avgType == "TMA")
                return m.addTriMovingAvg(avgPeriod, color);
            else if (avgType == "WMA")
                return m.addWeightedMovingAvg(avgPeriod, color);
        }
        return null;
    }

    /// &lt;summary&gt;
    /// Add an indicator chart to the FinanceChart object. In this demo example, the indicator
    /// parameters (such as the period used to compute RSI, colors of the lines, etc.) are hard
    /// coded to commonly used values. You are welcome to design a more complex user interface 
    /// to allow users to set the parameters.
    /// &lt;/summary&gt;
    /// &lt;param name="m"&gt;The FinanceChart object to add the line to.&lt;/param&gt;
    /// &lt;param name="indicator"&gt;The selected indicator.&lt;/param&gt;
    /// &lt;param name="height"&gt;Height of the chart in pixels&lt;/param&gt;
    /// &lt;returns&gt;The XYChart object representing indicator chart.&lt;/returns&gt;
    protected XYChart addIndicator(FinanceChart m, String indicator, int height)
    {
        if (indicator == "RSI")
            return m.addRSI(height, 14, 0x800080, 20, 0xff6666, 0x6666ff);
        else if (indicator == "StochRSI")
            return m.addStochRSI(height, 14, 0x800080, 30, 0xff6666, 0x6666ff);
        else if (indicator == "MACD")
            return m.addMACD(height, 26, 12, 9, 0xff, 0xff00ff, 0x8000);
        else if (indicator == "FStoch")
            return m.addFastStochastic(height, 14, 3, 0x6060, 0x606000);
        else if (indicator == "SStoch")
            return m.addSlowStochastic(height, 14, 3, 0x6060, 0x606000);
        else if (indicator == "ATR")
            return m.addATR(height, 14, 0x808080, 0xff);
        else if (indicator == "ADX")
            return m.addADX(height, 14, 0x8000, 0x800000, 0x80);
        else if (indicator == "DCW")
            return m.addDonchianWidth(height, 20, 0xff);
        else if (indicator == "BBW")
            return m.addBollingerWidth(height, 20, 2, 0xff);
        else if (indicator == "DPO")
            return m.addDPO(height, 20, 0xff);
        else if (indicator == "PVT")
            return m.addPVT(height, 0xff);
        else if (indicator == "Momentum")
            return m.addMomentum(height, 12, 0xff);
        else if (indicator == "Performance")
            return m.addPerformance(height, 0xff);
        else if (indicator == "ROC")
            return m.addROC(height, 12, 0xff);
        else if (indicator == "OBV")
            return m.addOBV(height, 0xff);
        else if (indicator == "AccDist")
            return m.addAccDist(height, 0xff);
        else if (indicator == "CLV")
            return m.addCLV(height, 0xff);
        else if (indicator == "WilliamR")
            return m.addWilliamR(height, 14, 0x800080, 30, 0xff6666, 0x6666ff);
        else if (indicator == "Aroon")
            return m.addAroon(height, 14, 0x339933, 0x333399);
        else if (indicator == "AroonOsc")
            return m.addAroonOsc(height, 14, 0xff);
        else if (indicator == "CCI")
            return m.addCCI(height, 20, 0x800080, 100, 0xff6666, 0x6666ff);
        else if (indicator == "EMV")
            return m.addEaseOfMovement(height, 9, 0x6060, 0x606000);
        else if (indicator == "MDX")
            return m.addMassIndex(height, 0x800080, 0xff6666, 0x6666ff);
        else if (indicator == "CVolatility")
            return m.addChaikinVolatility(height, 10, 10, 0xff);
        else if (indicator == "COscillator")
            return m.addChaikinOscillator(height, 0xff);
        else if (indicator == "CMF")
            return m.addChaikinMoneyFlow(height, 21, 0x8000);
        else if (indicator == "NVI")
            return m.addNVI(height, 255, 0xff, 0x883333);
        else if (indicator == "PVI")
            return m.addPVI(height, 255, 0xff, 0x883333);
        else if (indicator == "MFI")
            return m.addMFI(height, 14, 0x800080, 30, 0xff6666, 0x6666ff);
        else if (indicator == "PVO")
            return m.addPVO(height, 26, 12, 9, 0xff, 0xff00ff, 0x8000);
        else if (indicator == "PPO")
            return m.addPPO(height, 26, 12, 9, 0xff, 0xff00ff, 0x8000);
        else if (indicator == "UO")
            return m.addUltimateOscillator(height, 7, 14, 28, 0x800080, 20, 0xff6666, 0x6666ff);
        else if (indicator == "Vol")
            return m.addVolIndicator(height, 0x99ff99, 0xff9999, 0xc0c0c0);
        else if (indicator == "TRIX")
            return m.addTRIX(height, 12, 0xff);
        return null;
    }
   
    /// &lt;summary&gt;
    /// Creates a dummy chart to show an error message.
    /// &lt;/summary&gt;
    /// &lt;param name="viewer"&gt;The WinChartViewer to display the error message.&lt;/param&gt;
    /// &lt;param name="msg"&gt;The error message&lt;/param&gt;
    protected void errMsg(ChartViewer viewer, String msg)
    {
         MultiChart m = new MultiChart(400, 200);
         m.addTitle2(Chart.Center, msg, "Arial", 10).setMaxWidth(m.getWidth());
         viewer.setImage(m.makeImage());
    }
   
    //
    // Implementation of the DemoModule interface to allow this demo to run inside the 
    // ChartDirectorDemo browser
    //
    
    // Name of demo program
    public String toString() 
    { 
        return "Interactive Financial Chart"; 
    }

    // Number of charts produced in this demo
    public int getNoOfCharts() 
    { 
        // This demo open its own frame instead of using the right pane of the ChartDirectorDemo 
        // browser for display, so we just load the frame, then returns 0.
        initComponents(false); 
        setVisible(true); 
        return 0; 
    }

    // Main code for creating charts
    public void createChart(ChartViewer viewer, int index)
    {
        // Do nothing, as the ChartDirectorDemo browser right pane is not used.
    }
}</pre></tr></td></table></div><br>
<hr class="separator"><div class="copyright">&copy; 2008 Advanced Software Engineering Limited. All rights reserved.</div></body>
</HTML>
